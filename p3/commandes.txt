# Docker 
sudo usermod -aG docker $USER


# Create a cluster : 
k3d cluster create mycluster --agents 2 --servers 1 -p "8888:80@loadbalancer"

# Check if it's create : 
kubectl get nodes

#Create namespace :
kubectl create namespace argocd
kubectl create namespace dev

#Install Argo CD in namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml

# Wait ..

# Check if the pods is ready 
kubectl get pods -n argocd

# Expose web interface with Argo CD
kubectl port-forward svc/argocd-server -n argocd 8080:443

# Open on webpage :
https://localhost:8080

# Get admin password :
kubectl get secret argocd-initial-admin-secret -n argocd -o jsonpath="{.data.password}" | base64 -d

# Create a deployment.yaml


# Create Argo CD app :
argocd app create playground-app \
  --repo https://github.com/<ton-login>/<ton-repo>.git \
  --path . \
  --dest-server https://kubernetes.default.svc \
  --dest-namespace dev

# Synchronise :
argocd app sync playground-app

# Check deployment 
kubectl get pods -n dev

# Test update v1 to v2 :
git add deployment.yaml
git commit -m "Update to v2"
git push

# Check 
curl http://localhost:8888/

# Links :
https://kubernetes.io/docs/concepts/

# Notes :
# Generate a YAML model :
kubectl create deployment playground --image=wil42/playground:v1 -n dev --dry-run=client -o yaml > deployment.yaml

#Astuce : garde sous la main la commande kubectl explain <resource>
(ex: kubectl explain deployment.spec) → c’est la doc intégrée à ton cluster.

You can find Wil’s application on Dockerhub here:
https://hub.docker.com/r/wil42/playground

# Templates :
https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#creating-a-deployment

# Cluster list k3s
k3d cluster list

# Supprimer le cluster 

# Key words :
Helm 

# Voir dans quel contexte s'execute docker :
docker run --rm -it alpine whoami

# Supprimer l'image 
docker images

# Supprimer l'image 
docker rmi IMAGE_ID

# Delete a cluster 
sudo k3d cluster delete mycluster

kubectl -n argocd set env deploy/argocd-repo-server ARGOCD_GNUPG_ENABLED=false
kubectl delete pod -n argocd -l app.kubernetes.io/name=argocd-repo-server


my-github-repo/
├── dev/
│   ├── deployment.yaml
│   └── service.yaml
└── argocd/
    └── application.yaml


===================================================================
Déployer Argo CD (si pas déjà fait) et l’application :

kubectl apply -f argocd/application.yaml


Vérifier le pod et le service :

kubectl get pods -n dev
kubectl get svc -n dev
curl http://localhost:8888/


Mettre à jour l’application :

sed -i 's/wil42\/playground:v1/wil42\/playground:v2/g' dev/deployment.yaml
git add .
git commit -m "Update to v2"
git push